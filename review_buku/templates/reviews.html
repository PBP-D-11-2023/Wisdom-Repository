<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
        integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" />
    <title>Pinjam Buku</title>
	<style>
        body {
            font-size: 16px;
            font-family: "Book Antiqua";
			background-color: #F5F2ED;
        }
        .top-section {
            background-image: url('https://raw.githubusercontent.com/PBP-D-11-2023/Wisdom-Repository/anisha/assets/images/review.png');
            background-size: cover;
            background-position: center;
            width: 100vw;
			height: 60vh;
            color: white;
            position: relative;
            z-index:2;
        }
        .bottom-section {
            padding: 20px;
			height: 50vh;
            z-index:1;
        }
        .centered-image {
            width: 40vh;
            height: 54vh;
            position:relative;
            margin-left:2vw;
            margin-top:-15vh;
            margin-bottom:-10vh;
            z-index:3;
        }
        .border-image {
            border: 1vh solid white;
        }
        .text-margin-first {
            margin-left:55vh;
            margin-top:20vh;
            font-size: 28px;
        }
        .text-margin{
            margin-left:55vh;
            font-size: 20px;
        }
        .text-margin-bottom{
            margin-left:50vh;
            font-size: 18px;
            position:relative;
            margin-top:-30vh;
        }
        .button-pinjam{
            background-color: #37465D;
            color: white;
            padding: 10px 20px;
            border: 1px solid #37465D;
            border-radius: 5px;
            cursor: pointer;
			margin-top:5vh;
            margin-left:70vw;
        }
        .button-bookmark{
            background-color: white;
            color: #37465D;
            padding: 10px 20px;
            border: 1px solid #37465D;
            border-radius: 5px;
            cursor: pointer;
            margin-left:1vw;
        }
        .button-back{
            background-color: #37465D;
            color: white;
            padding: 10px 20px;
            border: 1px solid black;
            border-radius: 5px;
            cursor: pointer;
            margin-left:5vw;
        }

        .textarea-review {
            border: 1px solid #dcdcdc; /* Sama seperti textbox "Write a Review" tetapi dengan ukuran yang lebih besar */
            border-radius: 10px;
            border-color: black;
            background-color: #F5F2ED;
            padding: 20px;
            width: 100%;
            box-sizing: border-box;
            font-size: 14px;
            height: 200px; /* Tinggi textarea */
            resize: none; /* Menghilangkan kemampuan untuk mengubah ukuran */
        }
	</style>
</head>

<body>
    <header data-bs-theme="light">
        <nav class="navbar navbar-expand-md fixed-top bg-light" id="navbar-1">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <img src="https://raw.githubusercontent.com/PBP-D-11-2023/Wisdom-Repository/anisha/assets/images/wr%20logo.png" alt="Logo" width="156" height="52" class="d-inline-block align-text-top">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
                    aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse justify-content-end" id="navbarCollapse">
                    <ul class="nav justify-content-end me-3">
                        <li class="nav-item me-2">
                            <a class="nav-link active text-dark" href="#">Bookmark</a>
                        </li>
                        <li class="nav-item me-2">
                            <a class="nav-link active text-dark" href="#">Returned</a>
                        </li>
                        <li class="nav-item me-2">
                            <a class="nav-link active text-dark" href="#">Borrowed</a>
                        </li>
                        <li class="nav-item me-2">
                            <a class="nav-link active text-dark" href="#">Profile</a>
                        </li>
                        <li class="nav-item me-2">
                            <a class="nav-link active text-dark" href="#">Log Out</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
	<div class="container-fluid">
        <div class="row">
            <div class="col-md-0 top-section">
                <p class="text-margin-first">{{ buku.judul }}</p>
                <p class="text-margin"><i class="fas fa-user"></i> {{ buku.penulis }}</p>
                <p class="text-margin"><i class="fas fa-star"></i> {{ buku.rating }} / 5</p>
                <p class="text-margin"><i class="fas fa-calendar"></i> {{ buku.tahun }}</p>
            </div>
            <div class="col-md-0 centered-image">
                <img src="{{ buku.gambar }}" class="centered-image border-image" alt="Gambar Buku">
            </div>

            <form method="post" action="/postReview/">
                <label for="reviewArea">Write your review:</label>
                {% csrf_token %}
                <textarea class="textarea-review" name="review_text"></textarea>
                
                <!-- Ini adalah tombol Submit yang telah digantikan -->
                <!-- <input type="submit" value="Review" class="button-pinjam"> -->
                <input type="submit" value="Review" class="button-pinjam submit-review-btn">

            </form>

            <div class="col-md-0 bottom-section">
                <button type="button" class="button-back">Back</button>
            </div>
        </div>
            <!-- <label for="reviewArea">Write your review:</label>
            
            {% csrf_token %}
            <textarea class="textarea-review"></textarea>
            <div class="col-md-0 bottom-section">
                <button type="button" class="button-back">Back</button>
                <button type="button" class="button-pinjam">Review</button>
            </div> -->
    </div>
    <script>
        // Tangani tombol "Review" saat diklik
        document.querySelector('.button-pinjam').addEventListener('click', function() {
            // Dapatkan teks ulasan dari textarea
            let reviewText = document.querySelector('.textarea-review').value;
    
            // Kirim permintaan Ajax
            fetch('/postReview/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'), // Dapatkan token CSRF
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ review_text: reviewText }), // Kirim data ulasan sebagai JSON
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Review submitted!");
                    location.reload(); // Muat ulang halaman
                } else {
                    alert("There was an error submitting your review.");
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    
        // Fungsi untuk mendapatkan token CSRF dari cookie
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === name + '=') {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
    
    <!-- <script>
        const submitReview = () => {
            let reviewText = document.querySelector(".textarea-review").value;
            let csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

            fetch('/postReview/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': csrfToken
                },
                body: 'review_text=' + encodeURIComponent(reviewText)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Review submitted!");
                    location.reload();
                } else {
                    alert("There was an error submitting your review.");
                }
            });
        };

        document.querySelector('.submit-review-btn').addEventListener('click', submitReview);
    </script> -->
</body>

</html>